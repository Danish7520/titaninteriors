<!-- views/login.ejs -->
<!DOCTYPE html>
<html lang="en">

<head>
    <title>Titan Interiors</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<style>
    html {
        overflow-x: hidden;
    }
    /* estimation_area */
    /* end_estimation_area */
</style>

<body style="
background-color: #9d9d9d;
">
    <nav class="navbar navbar-inverse ">
        <div class="container-fluid" style="
    padding-right:0px;
    padding-left:0px;
    ">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#MyNavbar">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span> 
            </button>
                <img src="../images/logo.png" style="
            height: 80px;
            width: 300px;
        ">
            </div>
            <div class="collapse navbar-collapse" id="MyNavbar">
                <ul class="nav navbar-nav">
                    <li><a href="/" style="
                font-size: 20px;
                background-color:#222222;
                padding-bottom: 5px;
                top: 40px;
                left: 40px;
            ">Home</a></li>
                    <li ><a href="/estimation" style="
            font-size: 20px;
                background-color:#222222;
                padding-bottom: 5px;
                top: 40px;
                left: 40px;
            ">Estimation</a></li>
                    <li><a href="/VR" style="
            font-size: 20px;
                padding-bottom: 5px;
                top: 40px;
                left: 40px;
            ">VR</a></li>
                    <li><a href="/contacts" style="
            font-size: 20px;
                padding-bottom: 5px;
                top: 40px;
                left: 40px;
            ">Contacts</a></li>
                    <li><a href="/about" style="
            font-size: 20px;
                padding-bottom: 5px;
                top: 40px;
                left: 40px;
            ">About</a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li ><a href="/signup" style="
            font-size: 17px;
            
          padding-right: 15px;
      "><span class="glyphicon glyphicon-user"></span> Sign Up</a></li>
                    <li class="active"><a href="/login" style="
            font-size: 17px;
            background-color:#222222;
          padding-right: 40px;
          padding-left: 0px;
      "><span class="glyphicon glyphicon-log-in"></span> Login</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <script>
        function handleLogin(){
            
        var password = $('#password').val();
        var email = $('#email').val();
        if(email ==""){
            $('#erroremail').show();
                document.getElementById('erroremail').innerHTML=`  <div class="alert alert-danger alert-dismissable fade in">
                    <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                    <strong>*Email is required*</strong>
                  </div>`;
                  setTimeout(function() {
                                $('#erroremail').hide();
                              }, 2000);
            }
            else if(password ==""){
                $('#errorpassword').show();
                document.getElementById('errorpassword').innerHTML=`  <div class="alert alert-danger alert-dismissable fade in">
                    <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                    <strong>*Password is required*</strong>
                  </div>`;
                  setTimeout(function() {
                                $('#errorpassword').hide();
                              }, 2000);
            }
            else{
                $.ajax({
                  type: "POST",
                  url: "/login",
                  data: {email:document.getElementById("email").value,
                password:document.getElementById("password").value}
                })
                  .done(function(data) {
                      if(data){
                        console.log("done if" + data);
                    window.location.href = "index.ejs";
                    localStorage.setItem("userInfo",JSON.stringify({_id:data._id,FirstName:data.FirstName,LastName:data.LastName,Email:data.Email}))
                      }
                      else{
                        $('#errorpassword').show();
                        document.getElementById('errorpassword').innerHTML=`  <div class="alert alert-danger alert-dismissable fade in">
                    <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                    <strong>*Email or Password is incorrect*</strong>
                  </div>`;
                  setTimeout(function() {
                                $('#errorpassword').hide();
                              }, 2000);
                    // window.location.href = "login.ejs";
                      }
                   
                  })
                  .fail(function(jqXhr) {
                    // console.log("failed to register");
                  });
            }
            
            
               
        }
        
   


        
    </script>

 <div class="container">

        <div class="col-sm-6 col-sm-offset-3">

            <h1><span class="fa fa-sign-in"></span> Login</h1>

            

                    <!-- LOGIN FORM -->
                     
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" class="form-control" name="email" id="email">
                        </div>
                        <div id="erroremail"> 
                                
                            </div>
                        <div class="form-group">
                            <label>Password</label>
                            <input type="password" class="form-control" name="password" id="password">
                        </div>
                        <div id="errorpassword"> 
                                
                            </div>

                        <button  class="btn btn-warning btn-lg" onClick="handleLogin()">Login</button>
                    

                     <hr>

                    <p>Need an account? <a href="/signup">Signup</a></p>
                    <p>Or go <a href="/">home</a>.</p>

        </div>

    </div> 
   
    
   
  <footer>
    <div class="container text-center">
      <p style="padding-top:40px;">Copyright &copy; Titan Interiors 2017</p>
    </div>
  </footer>



    
   
    
</body>

</html>